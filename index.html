<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6B7F39">
    <title>Tree Tracker</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-192.png">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        #root { min-h-screen; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Storage
        const storage = {
            dbName: 'TreeTrackerDB',
            db: null,
            storageType: 'localStorage',
            init: async function() {
                return new Promise((resolve) => {
                    const request = indexedDB.open(this.dbName, 1);
                    request.onerror = () => { 
                        this.storageType = 'localStorage';
                        resolve(false); 
                    };
                    request.onsuccess = (event) => { 
                        this.db = event.target.result; 
                        this.storageType = 'IndexedDB';
                        resolve(true); 
                    };
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('data')) {
                            db.createObjectStore('data', { keyPath: 'key' });
                        }
                    };
                });
            },
            get: async function(key) {
                try {
                    if (this.db) {
                        return new Promise((resolve) => {
                            const tx = this.db.transaction(['data'], 'readonly');
                            const req = tx.objectStore('data').get(key);
                            req.onsuccess = () => resolve(req.result ? req.result.value : null);
                            req.onerror = () => resolve(localStorage.getItem(key));
                        });
                    }
                    return localStorage.getItem(key);
                } catch (e) { return localStorage.getItem(key); }
            },
            set: async function(key, value) {
                try {
                    if (this.db) {
                        return new Promise((resolve) => {
                            const tx = this.db.transaction(['data'], 'readwrite');
                            const req = tx.objectStore('data').put({ key, value });
                            req.onsuccess = () => resolve(true);
                            req.onerror = () => { localStorage.setItem(key, value); resolve(true); };
                        });
                    }
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) { localStorage.setItem(key, value); return true; }
            }
        };
        storage.init();

        // Image compression
        async function compressImage(file, maxSizeMB = 1) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width, height = img.height;
                        const maxDim = 1200;
                        if (width > height && width > maxDim) { height = (height / width) * maxDim; width = maxDim; }
                        else if (height > maxDim) { width = (width / height) * maxDim; height = maxDim; }
                        canvas.width = width; canvas.height = height;
                        canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                        let quality = 0.8, result = canvas.toDataURL('image/jpeg', quality);
                        while (result.length > maxSizeMB * 1024 * 1024 && quality > 0.1) {
                            quality -= 0.1;
                            result = canvas.toDataURL('image/jpeg', quality);
                        }
                        resolve(result);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function getConditionColor(condition) {
            const colors = {
                'good': 'bg-green-100 text-green-800 border-green-300',
                'medium': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                'bad': 'bg-orange-100 text-orange-800 border-orange-300',
                'RIP': 'bg-red-100 text-red-800 border-red-300'
            };
            return colors[condition] || 'bg-gray-100 text-gray-800';
        }

        function TreeTrackerApp() {
            const [trees, setTrees] = useState([]);
            const [plots, setPlots] = useState([]);
            const [currentTab, setCurrentTab] = useState('trees');
            const [currentView, setCurrentView] = useState('list');
            const [listViewMode, setListViewMode] = useState('grid'); // 'grid', 'compact', 'table', 'list'
            const [selectedTreeId, setSelectedTreeId] = useState(null);
            const [showForm, setShowForm] = useState(false);
            const [showPlotForm, setShowPlotForm] = useState(false);
            const [showImport, setShowImport] = useState(false);
            const [editId, setEditId] = useState(null);
            const [saveMsg, setSaveMsg] = useState('');
            const [loading, setLoading] = useState(true);
            const [newNote, setNewNote] = useState('');
            
            const [filterPlot, setFilterPlot] = useState('all');
            const [filterCondition, setFilterCondition] = useState('all');
            const [filterYear, setFilterYear] = useState('all');
            const [searchText, setSearchText] = useState('');
            
            const [treeForm, setTreeForm] = useState({
                name: '', species: '', plotName: '', treeNumber: '',
                size: 'medium', plantDate: '', condition: 'good', photo: '', notes: []
            });
            const [plotForm, setPlotForm] = useState({name: '', photo: '', description: ''});
            
            const fileRef = useRef(null);
            const importRef = useRef(null);

            useEffect(() => { loadData(); }, []);

            async function loadData() {
                try {
                    const td = await storage.get('trees');
                    const pd = await storage.get('plots');
                    if (td) setTrees(JSON.parse(td));
                    if (pd) setPlots(JSON.parse(pd));
                } catch (e) { console.error(e); }
                finally { setLoading(false); }
            }

            function showSave(msg) { setSaveMsg(msg); setTimeout(() => setSaveMsg(''), 3000); }

            async function saveTrees(data) { await storage.set('trees', JSON.stringify(data)); showSave('‚úÖ Saved!'); }
            async function savePlots(data) { await storage.set('plots', JSON.stringify(data)); showSave('‚úÖ Saved!'); }

            async function handleTreeSubmit(e) {
                e.preventDefault();
                const newTree = { 
                    id: editId || Date.now().toString(), 
                    ...treeForm,
                    notes: treeForm.notes || []
                };
                const updated = editId ? trees.map(t => t.id === editId ? newTree : t) : [...trees, newTree];
                setTrees(updated);
                await saveTrees(updated);
                resetTreeForm();
            }

            function resetTreeForm() {
                setTreeForm({name: '', species: '', plotName: '', treeNumber: '', size: 'medium', plantDate: '', condition: 'good', photo: '', notes: []});
                setShowForm(false);
                setEditId(null);
            }

            function editTree(tree) { 
                setTreeForm({...tree, notes: tree.notes || []}); 
                setEditId(tree.id); 
                setShowForm(true); 
            }

            async function deleteTree(id) {
                if (confirm('Delete tree?')) {
                    const updated = trees.filter(t => t.id !== id);
                    setTrees(updated);
                    await saveTrees(updated);
                    if (selectedTreeId === id) {
                        setSelectedTreeId(null);
                        setCurrentView('list');
                    }
                }
            }

            async function handlePhoto(e) {
                const file = e.target.files[0];
                if (file) {
                    const compressed = await compressImage(file, 1);
                    setTreeForm({...treeForm, photo: compressed});
                    showSave('‚úÖ Photo ready!');
                }
            }

            async function addNote(treeId, noteText) {
                if (!noteText.trim()) return;
                
                const noteEntry = {
                    id: Date.now().toString(),
                    text: noteText,
                    date: new Date().toISOString()
                };
                
                const updated = trees.map(t => {
                    if (t.id === treeId) {
                        return {...t, notes: [...(t.notes || []), noteEntry]};
                    }
                    return t;
                });
                
                setTrees(updated);
                await saveTrees(updated);
                setNewNote('');
            }

            async function deleteNote(treeId, noteId) {
                if (confirm('Delete this note?')) {
                    const updated = trees.map(t => {
                        if (t.id === treeId) {
                            return {...t, notes: (t.notes || []).filter(n => n.id !== noteId)};
                        }
                        return t;
                    });
                    setTrees(updated);
                    await saveTrees(updated);
                }
            }

            async function handlePlotSubmit(e) {
                e.preventDefault();
                const newPlot = { id: editId || Date.now().toString(), ...plotForm };
                const updated = editId ? plots.map(p => p.id === editId ? newPlot : p) : [...plots, newPlot];
                setPlots(updated);
                await savePlots(updated);
                setPlotForm({name: '', photo: '', description: ''});
                setShowPlotForm(false);
                setEditId(null);
            }

            async function deletePlot(id) {
                if (confirm('Delete plot?')) {
                    const updated = plots.filter(p => p.id !== id);
                    setPlots(updated);
                    await savePlots(updated);
                }
            }

            function viewTreeDetail(treeId) {
                setSelectedTreeId(treeId);
                setCurrentView('detail');
            }

            function backToList() {
                setSelectedTreeId(null);
                setCurrentView('list');
            }

            // Import/Export
            function downloadTemplate() {
                const template = `Tree Name,Species,Plot Name,Tree Number,Size,Plant Date,Condition
Oak Tree,Red Oak,North Garden,001,large,2024-01-15,good
Maple Tree,Sugar Maple,South Plot,002,medium,2024-02-20,medium
Pine Tree,White Pine,East Field,003,small,2023-12-10,good`;
                
                const blob = new Blob([template], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tree_template.csv';
                a.click();
                window.URL.revokeObjectURL(url);
            }

            function handleImport(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const text = event.target.result;
                        const lines = text.split('\n').filter(line => line.trim());
                        const dataLines = lines.slice(1);
                        
                        const importedTrees = dataLines.map((line, index) => {
                            const values = line.split(',').map(v => v.trim());
                            return {
                                id: Date.now().toString() + index,
                                name: values[0] || '',
                                species: values[1] || '',
                                plotName: values[2] || '',
                                treeNumber: values[3] || '',
                                size: values[4] || 'medium',
                                plantDate: values[5] || '',
                                condition: values[6] || 'good',
                                photo: '',
                                notes: []
                            };
                        }).filter(tree => tree.name && tree.species);

                        if (importedTrees.length === 0) {
                            alert('No valid tree data found');
                            return;
                        }

                        const updated = [...trees, ...importedTrees];
                        setTrees(updated);
                        await saveTrees(updated);
                        
                        alert(`Successfully imported ${importedTrees.length} trees!`);
                        setShowImport(false);
                        if (importRef.current) importRef.current.value = '';
                    } catch (error) {
                        alert('Error importing CSV file');
                    }
                };
                reader.readAsText(file);
            }

            function exportData() {
                const data = { trees, plots };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tree-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                window.URL.revokeObjectURL(url);
                showSave('‚úÖ Backup downloaded!');
            }

            function getFilteredTrees() {
                let filtered = trees;
                
                if (filterPlot !== 'all') {
                    filtered = filtered.filter(t => t.plotName === filterPlot);
                }
                
                if (filterCondition !== 'all') {
                    filtered = filtered.filter(t => t.condition === filterCondition);
                }
                
                if (filterYear !== 'all') {
                    filtered = filtered.filter(t => {
                        const year = new Date(t.plantDate).getFullYear();
                        return year.toString() === filterYear;
                    });
                }
                
                if (searchText.trim()) {
                    const search = searchText.toLowerCase();
                    filtered = filtered.filter(t => 
                        t.name.toLowerCase().includes(search) ||
                        t.species.toLowerCase().includes(search) ||
                        t.treeNumber.toLowerCase().includes(search)
                    );
                }
                
                return filtered;
            }

            function clearFilters() {
                setFilterPlot('all');
                setFilterCondition('all');
                setFilterYear('all');
                setSearchText('');
            }

            function getPlantYears() {
                const years = new Set();
                trees.forEach(t => {
                    if (t.plantDate) {
                        years.add(new Date(t.plantDate).getFullYear());
                    }
                });
                return Array.from(years).sort((a, b) => b - a);
            }

            if (loading) {
                return (
                    <div className="min-h-screen bg-green-50 flex items-center justify-center">
                        <div className="text-2xl text-green-700">Loading...</div>
                    </div>
                );
            }

            const filteredTrees = getFilteredTrees();
            const hasActiveFilters = filterPlot !== 'all' || filterCondition !== 'all' || filterYear !== 'all' || searchText.trim();
            const selectedTree = selectedTreeId ? trees.find(t => t.id === selectedTreeId) : null;

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4">
                    {saveMsg && (
                        <div style={{position: 'fixed', top: '20px', right: '20px', background: saveMsg.includes('‚úÖ') ? '#10b981' : '#ef4444', color: 'white', padding: '15px 25px', borderRadius: '10px', boxShadow: '0 4px 12px rgba(0,0,0,0.3)', zIndex: 9999}}>
                            {saveMsg}
                        </div>
                    )}

                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center gap-3">
                                <span className="text-4xl">ü´í</span>
                                <h1 className="text-3xl font-bold">Tree Tracker</h1>
                            </div>
                            <p className="text-gray-600 mt-2">
                                {currentTab === 'trees' && currentView === 'list' && (hasActiveFilters ? `Showing ${filteredTrees.length} of ${trees.length} trees` : `Total trees: ${trees.length}`)}
                                {currentTab === 'trees' && currentView === 'detail' && selectedTree && `${selectedTree.name} - Details`}
                                {currentTab === 'plots' && `Plots: ${plots.length}`}
                            </p>
                            <p className="text-xs text-gray-500 mt-1">
                                üíæ Storage: {storage.storageType} {storage.storageType === 'IndexedDB' ? '(Browser Database)' : '(Browser Cache)'}
                            </p>
                        </div>

                        {/* Tabs */}
                        <div className="bg-white rounded-lg shadow-lg p-2 mb-6 flex gap-2">
                            <button onClick={() => {setCurrentTab('trees'); setCurrentView('list');}} className={`flex-1 px-6 py-3 rounded-lg font-semibold ${currentTab === 'trees' ? 'bg-green-600 text-white' : 'bg-gray-100'}`}>üå≥ Trees</button>
                            <button onClick={() => setCurrentTab('plots')} className={`flex-1 px-6 py-3 rounded-lg font-semibold ${currentTab === 'plots' ? 'bg-green-600 text-white' : 'bg-gray-100'}`}>üìç Plots</button>
                        </div>

                        {/* TREES TAB - LIST VIEW */}
                        {currentTab === 'trees' && currentView === 'list' && (
                            <>
                                {/* Action Buttons */}
                                <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                                    <div className="flex justify-between items-center flex-wrap gap-3">
                                        <div className="flex gap-2 flex-wrap">
                                            <button onClick={() => setShowForm(!showForm)} className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">‚ûï Add Tree</button>
                                            <button onClick={downloadTemplate} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">üìÑ Download Template</button>
                                            <button onClick={() => setShowImport(!showImport)} className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">üì• Import CSV</button>
                                            <button onClick={exportData} className="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">üíæ Export Backup</button>
                                        </div>

                                        {/* View Mode Selector */}
                                        <div className="flex gap-2 bg-gray-100 p-1 rounded-lg">
                                            <button onClick={() => setListViewMode('grid')} className={`px-3 py-2 rounded transition-all ${listViewMode === 'grid' ? 'bg-white shadow text-green-600 font-semibold' : 'text-gray-600'}`} title="Grid View">‚äû</button>
                                            <button onClick={() => setListViewMode('compact')} className={`px-3 py-2 rounded transition-all ${listViewMode === 'compact' ? 'bg-white shadow text-green-600 font-semibold' : 'text-gray-600'}`} title="Compact View">‚ñ¶</button>
                                            <button onClick={() => setListViewMode('list')} className={`px-3 py-2 rounded transition-all ${listViewMode === 'list' ? 'bg-white shadow text-green-600 font-semibold' : 'text-gray-600'}`} title="List View">‚â°</button>
                                            <button onClick={() => setListViewMode('table')} className={`px-3 py-2 rounded transition-all ${listViewMode === 'table' ? 'bg-white shadow text-green-600 font-semibold' : 'text-gray-600'}`} title="Table View">‚ò∞</button>
                                        </div>
                                    </div>
                                </div>

                                {/* Import Section */}
                                {showImport && (
                                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                        <h2 className="text-xl font-bold mb-4">Import Trees from CSV</h2>
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                            <p className="text-sm text-blue-800 mb-2"><strong>CSV Format:</strong></p>
                                            <code className="text-xs">Tree Name, Species, Plot Name, Tree Number, Size, Plant Date, Condition</code>
                                            <p className="text-sm text-blue-800 mt-2">Size: very-small, small, medium, large</p>
                                            <p className="text-sm text-blue-800">Condition: good, medium, bad, RIP</p>
                                        </div>
                                        <input ref={importRef} type="file" accept=".csv" onChange={handleImport} className="w-full px-3 py-2 border rounded-lg" />
                                        <button onClick={() => setShowImport(false)} className="mt-4 bg-gray-300 hover:bg-gray-400 px-6 py-2 rounded-lg">Close</button>
                                    </div>
                                )}

                                {/* FILTERS */}
                                <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                                    <div className="flex items-center justify-between mb-3">
                                        <h3 className="font-semibold text-gray-700">üîç Filters</h3>
                                        {hasActiveFilters && (
                                            <button onClick={clearFilters} className="text-sm text-red-600 hover:text-red-800">‚úï Clear All</button>
                                        )}
                                    </div>
                                    
                                    <div className="grid md:grid-cols-4 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Search</label>
                                            <input type="text" placeholder="Name, species, number..." value={searchText} onChange={(e) => setSearchText(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Plot</label>
                                            <select value={filterPlot} onChange={(e) => setFilterPlot(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                <option value="all">All Plots</option>
                                                {[...new Set(trees.map(t => t.plotName))].sort().map(plot => (
                                                    <option key={plot} value={plot}>{plot}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Condition</label>
                                            <select value={filterCondition} onChange={(e) => setFilterCondition(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                <option value="all">All Conditions</option>
                                                <option value="good">Good</option>
                                                <option value="medium">Medium</option>
                                                <option value="bad">Bad</option>
                                                <option value="RIP">RIP</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Plant Year</label>
                                            <select value={filterYear} onChange={(e) => setFilterYear(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                <option value="all">All Years</option>
                                                {getPlantYears().map(year => (
                                                    <option key={year} value={year}>{year}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    {hasActiveFilters && (
                                        <div className="mt-3 pt-3 border-t flex flex-wrap gap-2">
                                            <span className="text-sm text-gray-600">Active:</span>
                                            {filterPlot !== 'all' && (<span className="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Plot: {filterPlot} <button onClick={() => setFilterPlot('all')} className="ml-1">‚úï</button></span>)}
                                            {filterCondition !== 'all' && (<span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">{filterCondition} <button onClick={() => setFilterCondition('all')} className="ml-1">‚úï</button></span>)}
                                            {filterYear !== 'all' && (<span className="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Year: {filterYear} <button onClick={() => setFilterYear('all')} className="ml-1">‚úï</button></span>)}
                                            {searchText.trim() && (<span className="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">Search: "{searchText}" <button onClick={() => setSearchText('')} className="ml-1">‚úï</button></span>)}
                                        </div>
                                    )}
                                </div>

                                {/* Tree Form */}
                                {showForm && (
                                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                        <h2 className="text-xl font-bold mb-4">{editId ? 'Edit' : 'Add'} Tree</h2>
                                        <form onSubmit={handleTreeSubmit} className="space-y-4">
                                            <div className="grid md:grid-cols-2 gap-4">
                                                <input required placeholder="Tree Name" value={treeForm.name} onChange={e => setTreeForm({...treeForm, name: e.target.value})} className="px-3 py-2 border rounded" />
                                                <input required placeholder="Species" value={treeForm.species} onChange={e => setTreeForm({...treeForm, species: e.target.value})} className="px-3 py-2 border rounded" />
                                                <input required placeholder="Plot Name" value={treeForm.plotName} onChange={e => setTreeForm({...treeForm, plotName: e.target.value})} className="px-3 py-2 border rounded" list="plotList" />
                                                <datalist id="plotList">{plots.map(p => <option key={p.id} value={p.name} />)}</datalist>
                                                <input required placeholder="Tree Number" value={treeForm.treeNumber} onChange={e => setTreeForm({...treeForm, treeNumber: e.target.value})} className="px-3 py-2 border rounded" />
                                                <select value={treeForm.size} onChange={e => setTreeForm({...treeForm, size: e.target.value})} className="px-3 py-2 border rounded">
                                                    <option value="very-small">Very Small</option>
                                                    <option value="small">Small</option>
                                                    <option value="medium">Medium</option>
                                                    <option value="large">Large</option>
                                                </select>
                                                <input required type="date" value={treeForm.plantDate} onChange={e => setTreeForm({...treeForm, plantDate: e.target.value})} className="px-3 py-2 border rounded" />
                                                <select value={treeForm.condition} onChange={e => setTreeForm({...treeForm, condition: e.target.value})} className="px-3 py-2 border rounded">
                                                    <option value="good">Good</option>
                                                    <option value="medium">Medium</option>
                                                    <option value="bad">Bad</option>
                                                    <option value="RIP">RIP</option>
                                                </select>
                                            </div>
                                            <div>
                                                <input ref={fileRef} type="file" accept="image/*" onChange={handlePhoto} className="px-3 py-2 border rounded w-full" />
                                                {treeForm.photo && <img src={treeForm.photo} className="mt-2 h-32 rounded object-cover" />}
                                            </div>
                                            <div className="flex gap-2">
                                                <button type="submit" className="bg-green-600 text-white px-6 py-2 rounded">Save</button>
                                                <button type="button" onClick={resetTreeForm} className="bg-gray-300 px-6 py-2 rounded">Cancel</button>
                                            </div>
                                        </form>
                                    </div>
                                )}

                                {/* Tree List - Different Views */}
                                {filteredTrees.length === 0 ? (
                                    <div className="bg-white rounded-lg shadow-lg p-12 text-center">
                                        <div className="text-6xl mb-4">üå≥</div>
                                        <h3 className="text-xl font-semibold text-gray-600">
                                            {hasActiveFilters ? 'No trees match filters' : 'No trees yet'}
                                        </h3>
                                        {hasActiveFilters && (<button onClick={clearFilters} className="mt-4 text-blue-600">Clear filters</button>)}
                                    </div>
                                ) : (
                                    <>
                                        {/* GRID VIEW - Full with pictures */}
                                        {listViewMode === 'grid' && (
                                            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                {filteredTrees.map(tree => (
                                                    <div key={tree.id} className="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow cursor-pointer" onClick={() => viewTreeDetail(tree.id)}>
                                                        {tree.photo && <img src={tree.photo} className="w-full h-48 object-cover" />}
                                                        <div className="p-4">
                                                            <div className="flex justify-between mb-2">
                                                                <div>
                                                                    <h3 className="font-bold">{tree.name} <span className="text-xs bg-blue-100 px-2 py-1 rounded">#{tree.treeNumber}</span></h3>
                                                                    <p className="text-sm text-gray-600 italic">{tree.species}</p>
                                                                </div>
                                                                <div className="flex gap-1" onClick={(e) => e.stopPropagation()}>
                                                                    <button onClick={() => editTree(tree)} className="text-blue-600">‚úèÔ∏è</button>
                                                                    <button onClick={() => deleteTree(tree.id)} className="text-red-600">üóëÔ∏è</button>
                                                                </div>
                                                            </div>
                                                            <div className="space-y-1 text-sm text-gray-600 mb-2">
                                                                <div>üìç {tree.plotName}</div>
                                                                <div>üìÖ {new Date(tree.plantDate).toLocaleDateString()}</div>
                                                                {tree.notes && tree.notes.length > 0 && (<div>üìù {tree.notes.length} note{tree.notes.length !== 1 ? 's' : ''}</div>)}
                                                            </div>
                                                            <div className={`inline-block px-3 py-1 rounded-full text-sm border ${getConditionColor(tree.condition)}`}>{tree.condition}</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        {/* COMPACT VIEW - Dense grid */}
                                        {listViewMode === 'compact' && (
                                            <div className="grid md:grid-cols-4 lg:grid-cols-5 gap-3">
                                                {filteredTrees.map(tree => (
                                                    <div key={tree.id} className="bg-white rounded-lg shadow p-3 hover:shadow-lg transition-shadow cursor-pointer" onClick={() => viewTreeDetail(tree.id)}>
                                                        <div className="flex justify-between items-start mb-2">
                                                            <div className="flex-1 min-w-0">
                                                                <h4 className="font-bold text-sm truncate">{tree.name}</h4>
                                                                <p className="text-xs text-gray-500 truncate">{tree.species}</p>
                                                            </div>
                                                            <div className="flex gap-1 ml-1" onClick={(e) => e.stopPropagation()}>
                                                                <button onClick={() => editTree(tree)} className="text-blue-600 text-xs">‚úèÔ∏è</button>
                                                                <button onClick={() => deleteTree(tree.id)} className="text-red-600 text-xs">üóëÔ∏è</button>
                                                            </div>
                                                        </div>
                                                        <div className="space-y-1">
                                                            <div className="flex items-center gap-1">
                                                                <span className="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full">#{tree.treeNumber}</span>
                                                            </div>
                                                            <p className="text-xs text-gray-600 truncate">üìç {tree.plotName}</p>
                                                            <div className={`inline-block px-2 py-0.5 rounded-full text-xs border ${getConditionColor(tree.condition)}`}>{tree.condition}</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        {/* LIST VIEW - No images */}
                                        {listViewMode === 'list' && (
                                            <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                                                {filteredTrees.map((tree, idx) => (
                                                    <div key={tree.id} className={`p-4 flex items-center justify-between hover:bg-gray-50 cursor-pointer ${idx !== 0 ? 'border-t' : ''}`} onClick={() => viewTreeDetail(tree.id)}>
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-1">
                                                                <h3 className="text-lg font-bold">{tree.name}</h3>
                                                                <span className="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">#{tree.treeNumber}</span>
                                                                <span className={`text-xs px-2 py-1 rounded-full border ${getConditionColor(tree.condition)}`}>{tree.condition}</span>
                                                            </div>
                                                            <div className="flex items-center gap-4 text-sm text-gray-600">
                                                                <span className="italic">{tree.species}</span>
                                                                <span>üìç {tree.plotName}</span>
                                                                <span>üìÖ {new Date(tree.plantDate).toLocaleDateString()}</span>
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2" onClick={(e) => e.stopPropagation()}>
                                                            <button onClick={() => editTree(tree)} className="px-3 py-1 text-blue-600 hover:bg-blue-50 rounded">‚úèÔ∏è</button>
                                                            <button onClick={() => deleteTree(tree.id)} className="px-3 py-1 text-red-600 hover:bg-red-50 rounded">üóëÔ∏è</button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        {/* TABLE VIEW - Spreadsheet style */}
                                        {listViewMode === 'table' && (
                                            <div className="bg-white rounded-lg shadow-lg overflow-x-auto">
                                                <table className="w-full">
                                                    <thead className="bg-green-600 text-white">
                                                        <tr>
                                                            <th className="px-4 py-3 text-left">Tree #</th>
                                                            <th className="px-4 py-3 text-left">Name</th>
                                                            <th className="px-4 py-3 text-left">Species</th>
                                                            <th className="px-4 py-3 text-left">Plot</th>
                                                            <th className="px-4 py-3 text-left">Planted</th>
                                                            <th className="px-4 py-3 text-left">Condition</th>
                                                            <th className="px-4 py-3 text-left">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {filteredTrees.map((tree, idx) => (
                                                            <tr key={tree.id} className={`${idx % 2 === 0 ? 'bg-gray-50' : 'bg-white'} hover:bg-green-50 cursor-pointer`} onClick={() => viewTreeDetail(tree.id)}>
                                                                <td className="px-4 py-3"><span className="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">#{tree.treeNumber}</span></td>
                                                                <td className="px-4 py-3 font-semibold">{tree.name}</td>
                                                                <td className="px-4 py-3 text-gray-600 italic">{tree.species}</td>
                                                                <td className="px-4 py-3 text-gray-600">{tree.plotName}</td>
                                                                <td className="px-4 py-3 text-sm text-gray-600">{new Date(tree.plantDate).toLocaleDateString()}</td>
                                                                <td className="px-4 py-3"><span className={`text-xs px-2 py-1 rounded-full border ${getConditionColor(tree.condition)}`}>{tree.condition}</span></td>
                                                                <td className="px-4 py-3" onClick={(e) => e.stopPropagation()}>
                                                                    <div className="flex gap-2">
                                                                        <button onClick={() => editTree(tree)} className="text-blue-600">‚úèÔ∏è</button>
                                                                        <button onClick={() => deleteTree(tree.id)} className="text-red-600">üóëÔ∏è</button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        )}
                                    </>
                                )}
                            </>
                        )}

                        {/* TREES TAB - DETAIL VIEW */}
                        {currentTab === 'trees' && currentView === 'detail' && selectedTree && (
                            <div>
                                <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                                    <button onClick={backToList} className="text-blue-600 hover:text-blue-800 font-semibold">‚Üê Back to Trees</button>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                    <div className="flex justify-between items-start mb-6">
                                        <div>
                                            <h2 className="text-3xl font-bold mb-2">
                                                {selectedTree.name}
                                                <span className="ml-3 text-lg bg-blue-100 text-blue-800 px-3 py-1 rounded-full">#{selectedTree.treeNumber}</span>
                                            </h2>
                                            <p className="text-xl text-gray-600 italic">{selectedTree.species}</p>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => editTree(selectedTree)} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">‚úèÔ∏è Edit</button>
                                            <button onClick={() => deleteTree(selectedTree.id)} className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">üóëÔ∏è Delete</button>
                                        </div>
                                    </div>

                                    {selectedTree.photo && (<div className="mb-6"><img src={selectedTree.photo} className="w-full max-h-96 object-cover rounded-lg" /></div>)}

                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <h3 className="font-semibold text-gray-700 mb-3">Tree Information</h3>
                                            <div className="space-y-2">
                                                <div className="flex items-center gap-2"><span className="font-medium">üìç Plot:</span><span>{selectedTree.plotName}</span></div>
                                                <div className="flex items-center gap-2"><span className="font-medium">üìè Size:</span><span className="capitalize">{selectedTree.size?.replace('-', ' ')}</span></div>
                                                <div className="flex items-center gap-2"><span className="font-medium">üìÖ Planted:</span><span>{new Date(selectedTree.plantDate).toLocaleDateString()}</span></div>
                                                <div className="flex items-center gap-2"><span className="font-medium">üè• Condition:</span><span className={`px-3 py-1 rounded-full text-sm border ${getConditionColor(selectedTree.condition)}`}>{selectedTree.condition}</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="text-2xl font-bold mb-4">üìù Notes History</h3>
                                    <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                                        <label className="block font-medium mb-2">Add New Note</label>
                                        <div className="flex gap-2">
                                            <input type="text" value={newNote} onChange={(e) => setNewNote(e.target.value)} placeholder="Type your note here..." className="flex-1 px-3 py-2 border rounded-lg" onKeyPress={(e) => { if (e.key === 'Enter') addNote(selectedTree.id, newNote); }} />
                                            <button onClick={() => addNote(selectedTree.id, newNote)} className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">Add Note</button>
                                        </div>
                                    </div>

                                    {!selectedTree.notes || selectedTree.notes.length === 0 ? (
                                        <div className="text-center py-8 text-gray-500"><p>No notes yet. Add your first note above!</p></div>
                                    ) : (
                                        <div className="space-y-3">
                                            {[...selectedTree.notes].reverse().map(note => (
                                                <div key={note.id} className="p-4 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div className="text-sm text-gray-500">üìÖ {new Date(note.date).toLocaleDateString()} at {new Date(note.date).toLocaleTimeString()}</div>
                                                        <button onClick={() => deleteNote(selectedTree.id, note.id)} className="text-red-600 hover:text-red-800 text-sm">üóëÔ∏è</button>
                                                    </div>
                                                    <p className="text-gray-800">{note.text}</p>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* PLOTS TAB */}
                        {currentTab === 'plots' && (
                            <>
                                <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                                    <button onClick={() => setShowPlotForm(!showPlotForm)} className="bg-green-600 text-white px-4 py-2 rounded-lg">‚ûï Add Plot</button>
                                </div>

                                {showPlotForm && (
                                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                        <h2 className="text-xl font-bold mb-4">{editId ? 'Edit' : 'Add'} Plot</h2>
                                        <form onSubmit={handlePlotSubmit} className="space-y-4">
                                            <input required placeholder="Plot Name" value={plotForm.name} onChange={e => setPlotForm({...plotForm, name: e.target.value})} className="w-full px-3 py-2 border rounded" />
                                            <textarea placeholder="Description" value={plotForm.description} onChange={e => setPlotForm({...plotForm, description: e.target.value})} className="w-full px-3 py-2 border rounded" rows="3" />
                                            <div className="flex gap-2">
                                                <button type="submit" className="bg-green-600 text-white px-6 py-2 rounded">Save</button>
                                                <button type="button" onClick={() => {setShowPlotForm(false); setEditId(null);}} className="bg-gray-300 px-6 py-2 rounded">Cancel</button>
                                            </div>
                                        </form>
                                    </div>
                                )}

                                {plots.length === 0 ? (
                                    <div className="bg-white rounded-lg shadow-lg p-12 text-center">
                                        <div className="text-6xl mb-4">üìç</div>
                                        <h3 className="text-xl font-semibold text-gray-600">No plots yet</h3>
                                    </div>
                                ) : (
                                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {plots.map(plot => (
                                            <div key={plot.id} className="bg-white rounded-lg shadow-lg p-4">
                                                <div className="flex justify-between mb-2">
                                                    <div>
                                                        <h3 className="text-xl font-bold">{plot.name}</h3>
                                                        <p className="text-sm text-gray-600">üå≥ {trees.filter(t => t.plotName === plot.name).length} trees</p>
                                                    </div>
                                                    <button onClick={() => deletePlot(plot.id)} className="text-red-600">üóëÔ∏è</button>
                                                </div>
                                                {plot.description && <p className="text-sm text-gray-600 mb-3">{plot.description}</p>}
                                                <button onClick={() => { setCurrentTab('trees'); setCurrentView('list'); setFilterPlot(plot.name); }} className="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">View Trees ‚Üí</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TreeTrackerApp />, document.getElementById('root'));
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
